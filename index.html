<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Agent Shift Planner</title>
  <style>
    :root{
      --bg:#05060a;
      --card:#0c0f14;
      --edge:#161b21;
      --text:#e5e7eb;
      --mut:#9ca3af;
      --accent:#00e676;
      --accent-2:#00c853;
      --danger:#ef4444;
      --ok:#22c55e;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--text); background:var(--bg); position:relative; overflow-x:hidden;
    }

    /* === SPACE THEME BACKDROP === */
    .space{
      position:fixed; inset:0; z-index:0; pointer-events:none;
      background: radial-gradient(1200px 800px at 70% 20%, rgba(0,230,118,0.08), transparent 60%),
                  radial-gradient(900px 600px at 20% 80%, rgba(0,200,83,0.06), transparent 60%),
                  radial-gradient(700px 500px at 40% 40%, rgba(0,230,118,0.05), transparent 60%),
                  linear-gradient(180deg, #040509, #06070c 40%, #040509);
      filter: saturate(105%);
    }
    .stars, .stars2, .stars3{
      position:fixed; inset:0; pointer-events:none; z-index:0; background-repeat:repeat; background-size:contain;
      animation: twinkle linear infinite;
    }
    .stars{ background-image: radial-gradient(1px 1px at 20px 30px, #d1fae5 20%, transparent 22%),
                                radial-gradient(1px 1px at 80px 120px, #bbf7d0 20%, transparent 22%),
                                radial-gradient(1px 1px at 200px 160px, #86efac 20%, transparent 22%);
            background-size: 200px 200px; animation-duration: 60s; opacity:.35; }
    .stars2{ background-image: radial-gradient(1px 1px at 60px 50px, #a7f3d0 20%, transparent 22%),
                                 radial-gradient(1px 1px at 140px 90px, #86efac 20%, transparent 22%),
                                 radial-gradient(1px 1px at 240px 190px, #d1fae5 20%, transparent 22%);
             background-size: 260px 260px; animation-duration: 90s; opacity:.25; }
    .stars3{ background-image: radial-gradient(1px 1px at 30px 80px, #86efac 20%, transparent 22%),
                                 radial-gradient(1px 1px at 180px 40px, #a7f3d0 20%, transparent 22%),
                                 radial-gradient(1px 1px at 220px 220px, #bbf7d0 20%, transparent 22%);
             background-size: 320px 320px; animation-duration: 120s; opacity:.18; }
    @keyframes twinkle{
      from{ transform: translate3d(0,0,0); }
      to{ transform: translate3d(-200px,-200px,0); }
    }

    .wrap{max-width:980px; margin:0 auto; padding:28px; position:relative; z-index:2}
    header{display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:14px}
    h1{font-size:22px; margin:0; font-weight:900; letter-spacing:0.2px}
    .sub{color:var(--mut); font-size:12px}

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.00));
      border:1px solid var(--edge); border-radius:16px; padding:18px;
      backdrop-filter: blur(6px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35), 0 0 0 1px rgba(255,255,255,0.02) inset;
    }
    .grid5{display:grid; grid-template-columns:repeat(5, minmax(0,1fr)); gap:12px}
    .lbl{font-size:12px; color:var(--mut); margin-bottom:6px}
    .inp, select{
      background:#0b0f13; color:var(--text); border:1px solid #1c232a; border-radius:12px;
      padding:12px 12px; width:100%; outline:none;
      transition:border-color .2s, box-shadow .2s;
    }
    .inp:focus, select:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(0,230,118,0.15)}
    .ro{opacity:.75; cursor:not-allowed}

    .hours{display:grid; grid-template-columns:repeat(13, minmax(0,1fr)); gap:10px}
    .hbtn{
      height:44px; display:flex; align-items:center; justify-content:center;
      border:1px solid #22272c; border-radius:12px; cursor:pointer; user-select:none;
      background:linear-gradient(180deg, #0f1113, #0b0d0f);
      transition:transform .06s ease, border-color .2s, box-shadow .2s, background .2s;
      font-weight:700; letter-spacing:.2px; color:#d1d5db;
    }
    .hbtn:hover{border-color:#2a3238; transform:translateY(-1px)}
    .hbtn.on{
      background:linear-gradient(180deg, rgba(0,230,118,0.18), rgba(0,200,83,0.16));
      border-color:rgba(0,230,118,0.55); color:#eafff1;
      box-shadow: 0 0 0 1px rgba(0,230,118,0.25) inset, 0 8px 22px rgba(0,230,118,0.10);
    }

    .actions{display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:16px}
    .btn{
      background:linear-gradient(180deg, var(--accent), var(--accent-2));
      color:#062e15; font-weight:900; border:none; border-radius:12px; padding:12px 16px; cursor:pointer;
      box-shadow:0 8px 26px rgba(0,230,118,0.25), 0 0 0 1px rgba(0,230,118,0.35) inset;
      transition:transform .06s ease, box-shadow .2s;
    }
    .btn:hover{transform:translateY(-1px); box-shadow:0 12px 36px rgba(0,230,118,0.35), 0 0 0 1px rgba(0,230,118,0.45) inset}
    .msg{font-size:12px}
    .ok{color:var(--ok)} .err{color:var(--danger)} .mut{color:var(--mut)}

    .cap-badge{
      display:inline-flex; align-items:center; gap:6px; font-size:12px; color:#a7f3d0;
      background:rgba(0,230,118,0.08); border:1px solid rgba(0,230,118,0.25); padding:6px 10px; border-radius:999px;
      box-shadow:0 0 0 1px rgba(0,230,118,0.15) inset;
    }
    .footer{margin-top:16px; font-size:11px; color:#9aa1a9}
    @media (max-width:920px){ .grid5{grid-template-columns:repeat(2, minmax(0,1fr));} .hours{grid-template-columns:repeat(4, minmax(0,1fr));} }
    @media (max-width:520px){ .grid5{grid-template-columns:1fr;} .hours{grid-template-columns:repeat(3, minmax(0,1fr));} }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.43.1/dist/umd/supabase.min.js"></script>
</head>
<body>
  <div class="space"></div>
  <div class="stars"></div>
  <div class="stars2"></div>
  <div class="stars3"></div>

  <div class="wrap">
    <header>
      <div>
        <h1>Agent Shift Planner</h1>
        <div class="sub">Interfaz de agentes · Space mode</div>
      </div>
      <div class="cap-badge" title="Capacidad fija por agente">Capacidad: <b>30</b> msgs/h</div>
    </header>

    <div class="card">
      <div class="grid5">
        <div>
          <div class="lbl">Fecha</div>
          <input class="inp" type="date" id="date">
        </div>
        <div>
          <div class="lbl">Nombre</div>
          <input class="inp" id="name" placeholder="Tu nombre">
        </div>
        <div>
          <div class="lbl">Email</div>
          <input class="inp" id="email" placeholder="tu@correo.com">
        </div>
        <div>
          <div class="lbl">Canal</div>
          <select id="channel" class="inp">
            <option value="mensajes">mensajes</option>
            <option value="llamadas">llamadas</option>
            <option value="ambos">ambos</option>
          </select>
        </div>
        <div>
          <div class="lbl">Capacidad (msgs/h)</div>
          <input class="inp ro" value="30" disabled>
          <div class="sub" style="font-size:11px">Fijado por operaciones</div>
        </div>
      </div>

      <div style="margin-top:14px">
        <div class="lbl">Selecciona tus horas (9:00–21:00)</div>
        <div class="hours" id="hours" aria-label="Selector de horas"></div>
      </div>

      <div class="actions">
        <button class="btn" id="save">Guardar turno(s)</button>
        <span id="msg" class="msg"></span>
      </div>

      <div class="footer">Se guarda en <code>public.bookings</code> y se refleja en tu panel de dimensionamiento.</div>
    </div>
  </div>

  <script>
    // Supabase (tu URL + anon key)
    const SUPABASE_URL = "https://wbplsmimcuphytdfjapz.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndicGxzbWltY3VwaHl0ZGZqYXB6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NTA3NzQsImV4cCI6MjA3ODQyNjc3NH0.1iC_zrG5FU2jCv_4qzqf8Si8t3cknA705ioPwOz3zSY";
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, { auth: { persistSession: false }});

    const FIXED_CAP = 30;
    const HOURS = [9,10,11,12,13,14,15,16,17,18,19,20,21];
    const sel = new Set();
    const $ = (id)=>document.getElementById(id);
    $('date').value = new Date().toISOString().slice(0,10);

    const paint = () => {
      const box = $('hours'); box.innerHTML='';
      HOURS.forEach(h=>{
        const d=document.createElement('div');
        d.className='hbtn'+(sel.has(h)?' on':'');
        d.textContent=h+":00";
        d.role="button"; d.tabIndex=0; d.setAttribute('aria-pressed', sel.has(h) ? 'true' : 'false');
        d.onclick=()=>{sel.has(h)?sel.delete(h):sel.add(h);paint();};
        d.onkeydown=(e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); d.click(); }};
        box.appendChild(d);
      });
    }; paint();

    $('save').onclick = async ()=>{
      const msg=$('msg'); msg.className='msg mut'; msg.textContent='Guardando…';
      const name=$('name').value.trim(), email=$('email').value.trim();
      const date=$('date').value, channel=$('channel').value;
      if(!name||!email||!date||sel.size===0){msg.className='msg err'; msg.textContent='Completa fecha, nombre, email y selecciona horas.'; return;}
      const rows = Array.from(sel).sort((a,b)=>a-b).map(h=>({date,hour:h,name,email,channel,cap_msg:FIXED_CAP}));
      try{
        const { error, status } = await sb.from('bookings').insert(rows);
        if(error){ msg.className='msg err'; msg.textContent = `Error (${status||'—'}): ${error.message}`; return; }
        msg.className='msg ok'; msg.textContent='Turnos guardados ✔️';
        sel.clear(); paint();
      }catch(e){
        msg.className='msg err'; msg.textContent='Excepción: '+(e?.message||String(e));
      }
    };
  </script>
</body>
</html>
